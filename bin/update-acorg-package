#! /bin/bash
source $(dirname $0)/__setup
if [[ $# -lt 1 ]]; then
    echo "Usage: $0 <package-name> [<pre-build-step>]" >&2
    exit 2
fi
PACKAGE="$1"
PRE_BUILD_STEP="$2"

echo "======================================================================"
echo Updating $PACKAGE
src_dir "$PACKAGE"
clone_or_pull "$ACMACS_PACKAGE_DIR" "git@github.com:acorg/$PACKAGE.git"

if [[ -n "$PRE_BUILD_STEP" ]]; then
    $PRE_BUILD_STEP
fi
make -C "$ACMACS_PACKAGE_DIR" clean
make -C "$ACMACS_PACKAGE_DIR" -j$NPROC install
make -C "$ACMACS_PACKAGE_DIR" -j$NPROC test
echo "======================================================================"
